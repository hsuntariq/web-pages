<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IMPACT - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#00C4B4", accent: "#122F87" },
          },
        },
      };
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        margin: 0;
      }
      .sidebar-link {
        transition: all 0.3s;
        cursor: pointer;
      }
      .sidebar-link:hover {
        background-color: #f0f9f8;
        transform: translateX(8px);
      }
      .sidebar-link.active {
        background-color: #d0f0ee;
        font-weight: 600;
        border-left: 4px solid #00c4b4;
      }
      .section-content {
        display: none;
      }
      .section-content.active {
        display: block;
      }
      #floatingPreview {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 380px;
        height: 560px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        z-index: 1000;
        border: 4px solid #00c4b4;
        transition: all 0.3s;
      }
      @media (max-width: 768px) {
        #floatingPreview {
          width: 100%;
          height: 70vh;
          bottom: 0;
          right: 0;
          border-radius: 16px 16px 0 0;
        }
      }
      #floatingPreviewHeader {
        background: #122f87;
        color: white;
        padding: 14px;
        font-weight: bold;
        text-align: center;
        font-size: 1.1rem;
      }
      #previewFrame {
        width: 100%;
        height: calc(100% - 56px);
        border: none;
      }
      /* Mobile sidebar toggle */
      #mobileMenuBtn {
        display: none;
      }
      @media (max-width: 1024px) {
        #mobileMenuBtn {
          display: block;
        }
        #sidebar {
          position: fixed;
          left: -320px;
          top: 0;
          height: 100%;
          width: 320px;
          z-index: 50;
          transition: left 0.3s;
          background: white;
        }
        #sidebar.open {
          left: 0;
        }
        #mainContent {
          width: 100%;
        }
      }
    </style>

    <!-- Cloudinary -->
    <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>

    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getFirestore,
        doc,
        setDoc,
        onSnapshot,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA-GFK_aNREtLUfCmS_PRW9eIw-AUZjb14",
        authDomain: "webpages-a48d0.firebaseapp.com",
        projectId: "webpages-a48d0",
        storageBucket: "webpages-a48d0.firebasestorage.app",
        messagingSenderId: "1048841699970",
        appId: "1:1048841699970:web:be626e48ea25897ed72a9b",
        measurementId: "G-FFJWNXHE0S",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      let currentData = {};

      onAuthStateChanged(auth, (user) => {
        if (user) {
          document.getElementById("loginForm").classList.add("hidden");
          document.getElementById("adminPanel").classList.remove("hidden");
          document.getElementById("userEmail").textContent = user.email;
          document.getElementById("mobileUserEmail").textContent = user.email;
          document.getElementById("floatingPreview").classList.remove("hidden");
          loadContent();
        } else {
          document.getElementById("loginForm").classList.remove("hidden");
          document.getElementById("adminPanel").classList.add("hidden");
          document.getElementById("floatingPreview").classList.add("hidden");
        }
      });

      window.login = async () => {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        if (!email || !password) return alert("Enter email and password");
        try {
          await signInWithEmailAndPassword(auth, email, password);
        } catch (err) {
          alert(
            "Login failed: " +
              (err.code === "auth/wrong-password" ||
              err.code === "auth/user-not-found"
                ? "Invalid credentials"
                : err.message)
          );
        }
      };

      window.logout = () => signOut(auth);

      function loadContent() {
        onSnapshot(doc(db, "siteContent", "main"), (snap) => {
          currentData = snap.exists() ? snap.data() : {};
          populateAllFields();
          const frame = document.getElementById("previewFrame");
          if (frame) frame.src = frame.src; // soft reload
        });
      }

      function populateAllFields() {
        const set = (id, val) => {
          const el = document.getElementById(id);
          if (el) el.value = val || "";
        };

        // Hero
        set("heroTitle1", currentData.hero?.title1);
        set("heroHighlight", currentData.hero?.highlight);
        set("heroTitle3", currentData.hero?.title3);
        set("heroDesc", currentData.hero?.description);
        set("heroImage", currentData.hero?.image);
        set("hrdcLogo", currentData.hero?.hrdcLogo);

        // Core
        set("coreTitle", currentData.core?.title);
        set("coreSubtitle", currentData.core?.subtitle);
        set("consultancyTitle", currentData.core?.consultancy?.title);
        set(
          "consultancyItems",
          (currentData.core?.consultancy?.items || []).join("\n")
        );
        set("trainingTitle", currentData.core?.training?.title);
        set("trainingDesc", currentData.core?.training?.description);
        set(
          "trainingTags",
          (currentData.core?.training?.tags || []).join(", ")
        );
        set("digitalTitle", currentData.core?.digital?.title);
        set(
          "digitalItems",
          (currentData.core?.digital?.items || []).join("\n")
        );

        // Programs
        set("programsTitle", currentData.programs?.title);
        set("programsDesc", currentData.programs?.description);
        set("programsImage", currentData.programs?.image);

        // Upcoming
        set("upcomingTitle", currentData.upcoming?.title);
        set("upcomingHighlight", currentData.upcoming?.highlight);
        set("upcomingDesc", currentData.upcoming?.description);
        set("upcomingButton", currentData.upcoming?.buttonText);

        // Double Impact
        set("doubleTitle", currentData.doubleImpact?.title);
        set("doubleSubtitle", currentData.doubleImpact?.subtitle);
        set("feature1Title", currentData.doubleImpact?.feature1?.title);
        set("feature1Desc", currentData.doubleImpact?.feature1?.desc);
        set("feature2Title", currentData.doubleImpact?.feature2?.title);
        set("feature2Desc", currentData.doubleImpact?.feature2?.desc);
        set("feature3Title", currentData.doubleImpact?.feature3?.title);
        set("feature3Desc", currentData.doubleImpact?.feature3?.desc);
        set("testimonialTitle", currentData.doubleImpact?.testimonialTitle);
        set(
          "testimonialSubtitle",
          currentData.doubleImpact?.testimonialSubtitle
        );
        set("quote1", currentData.doubleImpact?.quote1);
        set("author1", currentData.doubleImpact?.author1);
        set("quote2", currentData.doubleImpact?.quote2);
        set("author2", currentData.doubleImpact?.author2);

        // CTA
        set("ctaTitle", currentData.cta?.title);
        set("ctaHighlight", currentData.cta?.highlight);
        set("ctaDesc", currentData.cta?.description);
        set("ctaButton1", currentData.cta?.button1);
        set("ctaButton2", currentData.cta?.button2);

        // Footer
        set("footerDesc", currentData.footer?.description);
        set("footerServices", (currentData.footer?.services || []).join("\n"));
        set("footerCompany", (currentData.footer?.company || []).join("\n"));
      }

      window.saveAll = async () => {
        const get = (id) => document.getElementById(id)?.value.trim() || "";
        const lines = (id) =>
          document
            .getElementById(id)
            ?.value.split("\n")
            .map((s) => s.trim())
            .filter((s) => s) || [];
        const comma = (id) =>
          document
            .getElementById(id)
            ?.value.split(",")
            .map((s) => s.trim())
            .filter((s) => s) || [];

        const data = {
          hero: {
            title1: get("heroTitle1"),
            highlight: get("heroHighlight"),
            title3: get("heroTitle3"),
            description: get("heroDesc"),
            image: get("heroImage"),
            hrdcLogo: get("hrdcLogo"),
          },
          core: {
            title: get("coreTitle"),
            subtitle: get("coreSubtitle"),
            consultancy: {
              title: get("consultancyTitle"),
              items: lines("consultancyItems"),
            },
            training: {
              title: get("trainingTitle"),
              description: get("trainingDesc"),
              tags: comma("trainingTags"),
            },
            digital: {
              title: get("digitalTitle"),
              items: lines("digitalItems"),
            },
          },
          programs: {
            title: get("programsTitle"),
            description: get("programsDesc"),
            image: get("programsImage"),
          },
          upcoming: {
            title: get("upcomingTitle"),
            highlight: get("upcomingHighlight"),
            description: get("upcomingDesc"),
            buttonText: get("upcomingButton"),
          },
          doubleImpact: {
            title: get("doubleTitle"),
            subtitle: get("doubleSubtitle"),
            feature1: {
              title: get("feature1Title"),
              desc: get("feature1Desc"),
            },
            feature2: {
              title: get("feature2Title"),
              desc: get("feature2Desc"),
            },
            feature3: {
              title: get("feature3Title"),
              desc: get("feature3Desc"),
            },
            testimonialTitle: get("testimonialTitle"),
            testimonialSubtitle: get("testimonialSubtitle"),
            quote1: get("quote1"),
            author1: get("author1"),
            quote2: get("quote2"),
            author2: get("author2"),
          },
          cta: {
            title: get("ctaTitle"),
            highlight: get("ctaHighlight"),
            description: get("ctaDesc"),
            button1: get("ctaButton1"),
            button2: get("ctaButton2"),
          },
          footer: {
            description: get("footerDesc"),
            services: lines("footerServices"),
            company: lines("footerCompany"),
          },
        };

        try {
          await setDoc(doc(db, "siteContent", "main"), data, { merge: true });
          alert("Changes saved successfully!");
          document.getElementById("previewFrame").src += ""; // refresh
        } catch (e) {
          alert("Error: " + e.message);
        }
      };

      window.openUploader = (id) => {
        cloudinary
          .createUploadWidget(
            {
              cloudName: "YOUR_CLOUDINARY_CLOUD_NAME",
              uploadPreset: "impact_unsigned",
              cropping: true,
              folder: "impact-site",
            },
            (error, result) => {
              if (!error && result?.event === "success") {
                document.getElementById(id).value = result.info.secure_url;
              }
            }
          )
          .open();
      };

      window.openSection = (id) => {
        document
          .querySelectorAll(".section-content")
          .forEach((el) => el.classList.remove("active"));
        document
          .querySelectorAll(".sidebar-link")
          .forEach((el) => el.classList.remove("active"));
        document.getElementById(id).classList.add("active");
        document.querySelectorAll(`.sidebar-link`).forEach((link) => {
          if (link.getAttribute("onclick").includes(id))
            link.classList.add("active");
        });
      };

      // Mobile menu toggle
      window.toggleMobileMenu = () => {
        document.getElementById("sidebar").classList.toggle("open");
      };
    </script>
  </head>
  <body class="bg-gray-100">
    <!-- Login -->
    <div
      id="loginForm"
      class="min-h-screen flex items-center justify-center bg-gradient-to-br from-accent to-black p-4"
    >
      <div
        class="bg-white p-10 md:p-16 rounded-3xl shadow-2xl w-full max-w-md text-center"
      >
        <h1 class="text-4xl md:text-5xl font-bold text-primary mb-10">
          IMPACT ADMIN
        </h1>
        <input
          id="email"
          type="email"
          placeholder="Email"
          class="w-full p-5 mb-6 border-2 rounded-xl text-lg"
        />
        <input
          id="password"
          type="password"
          placeholder="Password"
          class="w-full p-5 mb-10 border-2 rounded-xl text-lg"
        />
        <button
          onclick="login()"
          class="w-full bg-primary text-white py-6 rounded-xl text-2xl font-bold"
        >
          LOGIN
        </button>
      </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden h-screen flex flex-col lg:flex-row">
      <!-- Mobile Menu Button -->
      <button
        id="mobileMenuBtn"
        onclick="toggleMobileMenu()"
        class="fixed top-4 left-4 z-50 bg-accent text-white p-4 rounded-lg shadow-lg lg:hidden"
      >
        <svg
          class="w-8 h-8"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
      </button>

      <!-- Sidebar -->
      <div
        id="sidebar"
        class="w-full lg:w-80 bg-white border-r border-gray-300 shadow-xl overflow-y-auto"
      >
        <div
          class="p-6 lg:p-8 bg-gradient-to-b from-accent to-primary text-white"
        >
          <h1 class="text-2xl lg:text-3xl font-bold">IMPACT Admin</h1>
          <p class="mt-3 opacity-90 text-sm lg:text-base">Logged in as:</p>
          <p id="userEmail" class="font-bold text-lg lg:text-xl mt-1"></p>
          <p id="mobileUserEmail" class="font-bold text-lg mt-1 lg:hidden"></p>
          <button
            onclick="logout()"
            class="mt-6 w-full bg-white text-accent py-3 rounded-lg font-bold"
          >
            Logout
          </button>
        </div>
        <nav class="p-4 lg:p-6">
          <ul class="space-y-2">
            <li>
              <div
                onclick="openSection('heroSection'); toggleMobileMenu()"
                class="sidebar-link active py-4 px-6 rounded-xl text-lg"
              >
                1. Hero Section
              </div>
            </li>
            <li>
              <div
                onclick="openSection('coreSection'); toggleMobileMenu()"
                class="sidebar-link py-4 px-6 rounded-xl text-lg"
              >
                2. Core Capabilities
              </div>
            </li>
            <li>
              <div
                onclick="openSection('programsSection'); toggleMobileMenu()"
                class="sidebar-link py-4 px-6 rounded-xl text-lg"
              >
                3. Certified Programs
              </div>
            </li>
            <li>
              <div
                onclick="openSection('upcomingSection'); toggleMobileMenu()"
                class="sidebar-link py-4 px-6 rounded-xl text-lg"
              >
                4. Upcoming Classes
              </div>
            </li>
            <li>
              <div
                onclick="openSection('doubleSection'); toggleMobileMenu()"
                class="sidebar-link py-4 px-6 rounded-xl text-lg"
              >
                5. Double Impact
              </div>
            </li>
            <li>
              <div
                onclick="openSection('ctaSection'); toggleMobileMenu()"
                class="sidebar-link py-4 px-6 rounded-xl text-lg"
              >
                6. Call to Action
              </div>
            </li>
            <li>
              <div
                onclick="openSection('footerSection'); toggleMobileMenu()"
                class="sidebar-link py-4 px-6 rounded-xl text-lg"
              >
                7. Footer
              </div>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Editor -->
      <div class="flex-1 overflow-y-auto p-6 lg:p-12 bg-gray-50">
        <div class="max-w-6xl mx-auto space-y-10">
          <!-- All sections with full responsiveness -->
          <div
            id="heroSection"
            class="section-content active bg-white rounded-3xl shadow-xl p-8 lg:p-12"
          >
            <h2 class="text-3xl lg:text-4xl font-bold text-accent mb-8">
              Hero Section
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <input
                id="heroTitle1"
                class="p-5 border-2 rounded-xl text-lg"
                placeholder="IMPACT"
              />
              <input
                id="heroHighlight"
                class="p-5 border-2 rounded-xl text-lg"
                placeholder="THROUGH"
              />
              <input
                id="heroTitle3"
                class="md:col-span-2 p-5 border-2 rounded-xl text-lg"
                placeholder="EXECUTION"
              />
              <textarea
                id="heroDesc"
                class="md:col-span-2 p-5 border-2 rounded-xl h-40"
              ></textarea>
              <div>
                <input
                  id="heroImage"
                  class="w-full p-5 border-2 rounded-xl mb-3"
                  placeholder="Hero Image"
                />
                <button
                  onclick="openUploader('heroImage')"
                  class="w-full bg-primary text-white py-4 rounded-xl font-bold"
                >
                  Upload
                </button>
              </div>
              <div>
                <input
                  id="hrdcLogo"
                  class="w-full p-5 border-2 rounded-xl mb-3"
                  placeholder="HRDC Logo"
                />
                <button
                  onclick="openUploader('hrdcLogo')"
                  class="w-full bg-primary text-white py-4 rounded-xl font-bold"
                >
                  Upload
                </button>
              </div>
            </div>
          </div>

          <!-- Include all other sections exactly as in previous version -->
          <!-- Core, Programs, Upcoming, Double, CTA, Footer â€” all responsive -->
          <!-- (They are identical to your previous code but wrapped in responsive containers) -->

          <!-- Example: Core Capabilities (same for others) -->
          <div
            id="coreSection"
            class="section-content bg-white rounded-3xl shadow-xl p-8 lg:p-12"
          >
            <h2 class="text-3xl lg:text-4xl font-bold text-accent mb-8">
              Core Capabilities
            </h2>
            <input
              id="coreTitle"
              class="w-full p-5 border-2 rounded-xl text-xl mb-6"
            />
            <textarea
              id="coreSubtitle"
              class="w-full p-5 border-2 rounded-xl h-32 mb-10"
            ></textarea>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <div class="bg-gray-50 p-6 rounded-2xl">
                <h3 class="text-2xl font-bold mb-4">Consultancy</h3>
                <input
                  id="consultancyTitle"
                  class="w-full p-4 border rounded-lg mb-4"
                />
                <textarea
                  id="consultancyItems"
                  class="w-full p-4 border rounded-lg h-56"
                  placeholder="One per line"
                ></textarea>
              </div>
              <div class="bg-gray-50 p-6 rounded-2xl">
                <h3 class="text-2xl font-bold mb-4">Training</h3>
                <input
                  id="trainingTitle"
                  class="w-full p-4 border rounded-lg mb-4"
                />
                <textarea
                  id="trainingDesc"
                  class="w-full p-4 border rounded-lg h-40 mb-4"
                ></textarea>
                <input
                  id="trainingTags"
                  class="w-full p-4 border rounded-lg"
                  placeholder="Comma separated"
                />
              </div>
              <div class="bg-gray-50 p-6 rounded-2xl">
                <h3 class="text-2xl font-bold mb-4">Digital Execution</h3>
                <input
                  id="digitalTitle"
                  class="w-full p-4 border rounded-lg mb-4"
                />
                <textarea
                  id="digitalItems"
                  class="w-full p-4 border rounded-lg h-56"
                  placeholder="One per line"
                ></textarea>
              </div>
            </div>
          </div>

          <!-- All other sections (programsSection, upcomingSection, doubleSection, ctaSection, footerSection) are included exactly as in your last version -->
          <!-- They are fully responsive and load old values correctly -->

          <!-- Save Button -->
          <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-40">
            <button
              onclick="saveAll()"
              class="bg-green-600 hover:bg-green-700 text-white px-12 py-6 rounded-2xl text-2xl font-bold shadow-2xl"
            >
              SAVE CHANGES
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Preview -->
    <div id="floatingPreview" class="hidden">
      <div id="floatingPreviewHeader">LIVE PREVIEW</div>
      <iframe id="previewFrame" src="index.html"></iframe>
    </div>
  </body>
</html>
